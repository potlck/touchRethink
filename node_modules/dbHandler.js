module.exports = {
	init: function() {
    	r = require('rethinkdb')
		http = require('http');
		path = require('path')

    	var temp = path.dirname(require.main.filename);
    	var dbName = path.basename(temp);

    	r.connect({ host: 'localhost', port: 28015 }, function(err, conn) {
  			if(err) throw err;
  			r.dbList().run(conn, function(err, dbs) {
  				if(err) throw err;
				console.log("Got DB list");
				if (dbs.indexOf(dbName) > -1) {
					console.log("Db exists");
				} else {
					console.log("Db does not exist");
					r.dbCreate(dbName).run(conn, function(err, other) {
						if (err) throw err;
					});
				}
  			});
		});
		return dbName;
	},
	tableCreate: function(dbName, table) {
		console.log(dbName);
		r.connect({ host: 'localhost', port: 28015, db: dbName }, function(err, conn) {
			if(err) throw err;
			r.tableCreate(table).run(conn, function(err) {
				if(err) throw err;
			});
		});
	},
	tableDrop: function(dbName, table) {
		r.connect({ host: 'localhost', port: 28015, db: dbName }, function(err, conn) {
			if(err) throw err;
			r.tableDrop(table).run(conn, function(err) {
				if(err) throw err;
			});
		});
	},
	insert: function(dbName, table, json) {
		r.connect({ host: 'localhost', port: 28015, db: dbName }, function(err, conn) {
			if(err) throw err;
			r.table(table).insert(json).run(conn, function(err) {
				if(err) throw err;
			});
		});
	},
	delete: function(dbName, table, uid) {
		r.connect({ host: 'localhost', port: 28015, db: dbName }, function(err, conn) {
			if(err) throw err;
			// have to do r.get(on uid) and then call delete --- untested
			r.table(table).get(uid).delete().run(conn, function(err) {
				if(err) throw err;
			});

			//r.delete(json).run(conn, function(err) {
			//	if(err) throw err;
			//});
		});
	},
	getR: function() {
		var r = r.connect({ host: 'localhost', port: 28015, db: dbName });
		return r; // # use p.then in this context: see documentation
		// http://rethinkdb.com/api/javascript/connect/
	}
};

//fs = require("fs");
//args = process.argv.slice(2);
//console.log(args)

// grab path of where it's running and thing 
//in the directory above you will be the app id

// from within the module can I get the path of 
